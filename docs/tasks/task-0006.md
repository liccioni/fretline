# Task 0006 — Builder: Drill Type Support + Validation Hardening

## Context
The current Builder/Editor only supports Generic drills, which conflicts with the v1 spec requiring all drill types and type-specific fields. This task extends the Builder to cover all drill types while keeping UI minimal and ensuring invalid drills cannot be added.

## Goal
Add Builder support for all v1 drill types with type-specific fields, safe defaults, and stricter validation so only valid drills can be added and edited without data loss.

## Authoritative Sources
- `docs/spec-v1.md`: Drill Types; Screens → Session Builder; Drill Editor; Persistence; Definition of Done (v1)
- `docs/tasks/_template.md`
- `docs/workflow.md`

## Spec status (pick ONE and explain)
- [ ] Partial — staged by design
- [x] Complete — satisfies v1 Definition of Done
- [ ] Deviating — temporary spec violation

Explanation (required):
This task completes v1 drill type support in the Builder/Editor while keeping UI minimal (no polish).

## Scope (In scope)
- Builder support for all drill types:
  - Generic
  - Note Location
  - Triad Location
  - Spider / Finger Independence
- Type-specific fields and inline editing per the spec
- Automatic valid defaults on drill creation
- Inline, blocking validation
- Strict enforcement: invalid drills cannot be added
- Union-safe session editing (no data loss for non-Generic drills)

## Out of scope
- Routing libraries
- Persistence beyond localStorage
- Session Runner changes except where strictly needed to display existing drill data
- UI polish beyond minimal functional layout

## Requirements / Behavior
- Drill type selection:
  - Allow selecting the drill type when adding a drill
  - Existing drills display and edit their type-specific fields
- Type-specific fields (per spec):
  - Generic: no additional fields
  - Note Location: `string` (1–6), `note` (A–G with #/b), `fretRange: [number, number]`
  - Triad Location: `triadType`, `stringSet: number[]`, `key`
  - Spider: `pattern`, `fretRange: [number, number]`
- Defaults on creation:
  - `metronome.beatsPerBar` defaults to 4
  - Other required fields must have valid defaults so the drill is valid immediately, OR the UI must prevent adding until valid (no invalid additions)
- Validation (inline, blocking):
  - Session name non-empty
  - Drill name non-empty
  - `durationSeconds > 0`
  - `metronome.bpm > 0`
  - `metronome.beatsPerBar > 0` (default to 4 if missing)
  - Note Location: `string` in 1–6, valid `note`, valid `fretRange`
  - Triad Location: valid `triadType`, non-empty `stringSet`, non-empty `key`
  - Spider: non-empty `pattern`, valid `fretRange`
- Union-safe editing:
  - Editing a session must preserve drill type and all type-specific fields
  - No casting to `GenericDrill[]` that can drop data

## Acceptance Criteria
- [ ] Builder can create and edit drills of all v1 types (Generic, Note Location, Triad Location, Spider)
- [ ] Drill type-specific fields are displayed and editable per spec
- [ ] New drills are valid immediately or cannot be added until valid (no invalid drills in list)
- [ ] Inline validation blocks Save/Run and shows field-specific errors
- [ ] Session editing preserves all drill data without loss across types
- [ ] No routing libraries introduced
- [ ] Persistence remains local-only (localStorage)
- [ ] Runner unchanged except minimal display needs for existing drill data

## Review Bundle / PR Requirements
- One task = one PR
- PR must link this task file
- PR description must use `.github/pull_request_template.md`
- For ChatGPT review: paste PR description + `git status --short` + `git diff main...HEAD`

## Completion (fill when done)
- Status:
- Completed date (YYYY-MM-DD):
- Summary:
